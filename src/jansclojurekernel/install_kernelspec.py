#!/usr/bin/env python
# *_* coding: utf-8 *_*

"""clojure kernel installer helper"""

import os
import shutil
from jupyter_client.kernelspec import KernelSpecManager

JSON = """{"argv":["python","-m","jansclojurekernel", "-f", "{connection_file}"],
 "display_name":"Clojure"
}"""

SVG = """<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   version="1.1"
   width="300"
   height="300"
   id="svg2"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:dc="http://purl.org/dc/elements/1.1/">
  <metadata
     id="metadata4">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <defs
     id="defs6" />
  <path
     d="M 148.99722,0 C 66.843236,0 0,66.843236 0,148.99955 c 0,82.16329 66.843236,149.00304 148.99722,149.00304 82.15631,0 148.99955,-66.83975 148.99955,-149.00304 C 297.99677,66.843236 231.15353,0 148.99722,0"
     id="path8"
     style="fill:#ffffff;stroke-width:1.16405"
     transform="translate(1.001615,0.998705)" />
  <path
     d="m 143.5483,151.67919 c -1.33866,2.90081 -2.81583,6.16015 -4.3454,9.62902 -5.40701,12.25046 -11.39488,27.15728 -13.58213,36.70715 -0.78573,3.40135 -1.27231,7.61638 -1.26299,12.29004 0,1.84851 0.0989,3.79131 0.25609,5.77019 7.64431,2.80886 15.90092,4.35355 24.52304,4.36868 7.84918,-0.0151 15.3899,-1.31188 22.44753,-3.65861 -1.65877,-1.51675 -3.24188,-3.13362 -4.68297,-4.95536 -9.56849,-12.20157 -14.90682,-30.0837 -23.35317,-60.15111"
     id="path10"
     style="fill:#91dc47;stroke-width:1.16405"
     transform="translate(1.001615,0.998705)" />
  <path
     d="M 108.22172,91.057801 C 89.947298,103.93685 77.989013,125.17843 77.943615,149.25098 c 0.0454,23.71286 11.643991,44.67973 29.458615,57.61232 4.36984,-18.20225 15.32355,-34.86911 31.74946,-68.27734 -0.97548,-2.67965 -2.08715,-5.61305 -3.33152,-8.69429 -4.55027,-11.41467 -11.11784,-24.67087 -16.97883,-30.673879 -2.98811,-3.135951 -6.61413,-5.845859 -10.61962,-8.15999"
     id="path12"
     style="fill:#91dc47;stroke-width:1.16405"
     transform="translate(1.001615,0.998705)" />
  <path
     d="m 211.15166,230.90908 c -9.4288,-1.18151 -17.21047,-2.60747 -24.01784,-5.00891 -11.44959,5.68522 -24.34377,8.89684 -37.99691,8.89684 -47.2418,0 -85.537881,-38.29026 -85.543701,-85.54603 0,-25.64052 11.29594,-48.62585 29.166433,-64.302113 C 87.980053,83.79413 82.995592,83.120145 77.904038,83.129458 52.804794,83.36576 26.309855,97.256367 15.279319,134.7702 c -1.031349,5.46056 -0.785734,9.58944 -0.785734,14.48311 0,74.36533 60.287307,134.65263 134.646815,134.65263 45.53996,0 85.76952,-22.62796 110.13192,-57.23516 -13.17704,3.28378 -25.84889,4.85408 -36.70016,4.88784 -4.06719,0 -7.88528,-0.21768 -11.4205,-0.64954"
     id="path14"
     style="fill:#63b132;stroke-width:1.16405"
     transform="translate(1.001615,0.998705)" />
  <path
     d="m 185.84987,204.81807 c 0.83114,0.41207 2.71573,1.08489 5.33834,1.82872 17.6435,-12.95238 29.10939,-33.81565 29.15479,-57.39581 h -0.007 c -0.0663,-39.31113 -31.87867,-71.118789 -71.19911,-71.19678 -7.81544,0.01513 -15.32356,1.3049 -22.35325,3.634164 14.45633,16.47829 21.40804,40.027016 28.13275,65.786276 0.003,0.0116 0.009,0.021 0.0116,0.0303 0.0128,0.0209 2.15117,7.15308 5.82258,16.61565 3.64581,9.44975 8.8398,21.14845 14.50406,29.67395 3.71914,5.71316 7.80961,9.81877 10.59518,11.02356"
     id="path16"
     style="fill:#90b4fe;stroke-width:1.16405"
     transform="translate(1.001615,0.998705)" />
  <path
     d="m 149.1404,14.598349 c -45.09995,0 -84.994268,22.201924 -109.430003,56.244562 12.717245,-7.964429 25.702221,-10.837304 37.034247,-10.734868 15.651815,0.0454 27.956986,4.898322 33.861046,8.218192 1.42596,0.82182 2.77975,1.706497 4.1056,2.61562 10.53466,-4.639902 22.17515,-7.23457 34.42562,-7.23457 47.24762,0.0058 85.54951,38.296075 85.5565,85.543695 h -0.007 c 0,23.82112 -9.74309,45.35953 -25.44962,60.86933 3.85533,0.43187 7.96676,0.70076 12.16549,0.67981 14.91264,0.007 31.03124,-3.28379 43.11524,-13.4471 7.87945,-6.63742 14.48078,-16.35607 18.14172,-30.92765 0.71589,-5.62818 1.12796,-11.34948 1.12796,-17.17206 0,-74.361833 -60.28149,-134.654961 -134.64681,-134.654961"
     id="path18"
     style="fill:#5881d8;stroke-width:1.16405"
     transform="translate(1.001615,0.998705)" />
</svg>"""


def install_kernelspec():
    kerneldir = "/tmp/jansclojurekernel/"
    print('Creating tmp files...', end="")
    os.mkdir(kerneldir)

    with open(kerneldir + "kernel.json", "w") as file:
        file.write(JSON)

    with open(kerneldir + "logo-svg.svg", "w") as file:
        file.write(SVG)

    print(' Done!')
    print('Installing Jupyter kernel...', end="")

    ksm = KernelSpecManager()
    ksm.install_kernel_spec(kerneldir, 'jansclojurekernel', user=os.getenv('USER'))

    print(' Done!')
    print('Cleaning up tmp files...', end="")

    shutil.rmtree(kerneldir)

    print(' Done!')
    print('For uninstall use: jupyter kernelspec uninstall jansclojurekernel')
